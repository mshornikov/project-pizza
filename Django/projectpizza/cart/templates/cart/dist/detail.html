{% extends '../main/baseStructure.html' %}

{% block content %}
<div class="title">Корзина</div>
<!-- Обертка корзины -->
<div class="cart">
    <!-- Ограничитель -->
    <div class="container">
        {% for message in messages %}
            <div class="message {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
        <form action="{% url 'stock_accept' %}" method='post'>
            {% csrf_token%}
            {{stock_form.as_p}}
            <button type='sybmit'>Добавить товар</button>
        </form>
        {% if length > 0 %}
        <!-- Содержимое корзины -->
        <div class="cart_inner">
            <h5 class='cart_name'>Ваша корзина:</h5>
            <p> 
                {% with total_items=cart|length %}
                <span class='total_items'>{{ total_items }} Товар(а),</span>
                <span clsas='total_price'>{{ cart.get_total_price|floatformat:2 }} руб  </span>
                {% endwith %}
            </p>
            {% for dict in cart %}
                {% with item=dict.item %}
                {% with type=dict.type %}
                    <!-- Представление одой позиции -->
                    <div class="cart_item">
                        {% with product=item.product %}
                        <!-- Фото -->
                        <img src="{{ product.image.url }}" alt="Фото позиции">
                        <div class="single_item_view">
                            <!-- Названия пунктов -->
                            <div class="item_information">
                                    <h5 class="cart_navPoint">Название</h5>
                                    <h5 class="cart_navPoint">Изменить</h5>
                                    <h5 class="cart_navPoint">Количество</h5>
                                    <h5 class="cart_navPoint">Цена</h5>
                                    <h5 class="cart_navPoint">Общая стоимость</h5>
                            </div>
                            <!-- Данные о товаре в корзине -->
                            <div class="item_data">
                                <h5 class="position">{{product.name}}</h5>
                                {% if type == 'default' %}
                                <form action="{% url 'cart_add' product.id %}" method="post" class="position">
                                    {% csrf_token %}
                                    {{ item.update_quantity_form.quantity }}
                                    {{ item.update_quantity_form.update }}
                                    <input type="submit" value="Добавить">
                                </form>
                                {% else %}
                                <span class='position'>Акционный товар</span>
                                {% endif %}
                                <p class="position">{{item.quantity}}</p> <br>
                                <p class="position">{{item.price|floatformat:2 }}</p> <br>
                                <p class="position">{{item.total_price|floatformat:2}}</p> 
                            </div>
                        </div>
                        <!-- Управление товаром в корзине -->
                        <form action="{% url 'cart_remove' product.id type %}" method='post'>
                            {% csrf_token %}
                            <button class='cart_del_btn'>Удалить</button>
                        </form>
                        {% endwith %}
                    </div>
                {% endwith %}
                {% endwith %}
            {% endfor %}
            <!-- Кнопка формирования заказа -->
            {% if request.user.is_authenticated %}
                <a href="{% url 'order_create' %}" class="order_create_btn">Оформить заказ</a>
                <p class='order_paid_attention'>Обратите внимание, оплата принимается только наличными, по адресу доставки заказа</p>
            {% else %}
                <p class='order_lohout_text'>Чтобы иметь возможность оформить заказ, пожалуйста, авторизуйтесь</p>
                <div class="rev_btn">
                    <a href="{% url 'register' %}" class="btn_reg">Регистрация</a>
                    <a href="{% url 'login' %}" class="btn_auth">Авторизация</a>
                </div>
            {% endif %}
        </div>
        {% else %}
        <h5 class='cart_name'>Корзина пуста, к сожалению</h5>
        {% endif %}
    </div>
</div>
{% endblock %}